<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= page_title or "ç®¡ç†ç”»é¢" %> - LuaAIDiary</title>
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <div class="admin-wrapper">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="admin-header">
            <div class="header-left">
                <button class="menu-toggle" id="menuToggle">â˜°</button>
                <h1 class="site-title">LuaAIDiary ç®¡ç†ç”»é¢</h1>
            </div>
            <div class="header-right">
                <% if user then %>
                    <div class="user-info">
                        <span class="user-icon">ğŸ‘¤</span>
                        <span class="username"><%= user.username or user.email %></span>
                    </div>
                    <form method="POST" action="/auth/logout" class="logout-form">
                        <input type="hidden" name="csrf_token" value="<%= csrf_token %>">
                        <button type="submit" class="btn-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                    </form>
                <% end %>
            </div>
        </header>

        <div class="admin-container">
            <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <aside class="admin-sidebar" id="adminSidebar">
                <nav class="sidebar-nav">
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="/admin/dashboard" class="nav-link <%= active_menu == 'dashboard' and 'active' or '' %>">
                                <span class="nav-icon">ğŸ“Š</span>
                                <span class="nav-text">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/posts" class="nav-link <%= active_menu == 'posts' and 'active' or '' %>">
                                <span class="nav-icon">ğŸ“</span>
                                <span class="nav-text">æŠ•ç¨¿</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/posts/new" class="nav-link <%= active_menu == 'posts_new' and 'active' or '' %>">
                                <span class="nav-icon">â•</span>
                                <span class="nav-text">æ–°è¦æŠ•ç¨¿</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/categories" class="nav-link <%= active_menu == 'categories' and 'active' or '' %>">
                                <span class="nav-icon">ğŸ“</span>
                                <span class="nav-text">ã‚«ãƒ†ã‚´ãƒªãƒ¼</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/admin/tags" class="nav-link <%= active_menu == 'tags' and 'active' or '' %>">
                                <span class="nav-icon">ğŸ·ï¸</span>
                                <span class="nav-text">ã‚¿ã‚°</span>
                            </a>
                        </li>
                        <li class="nav-divider"></li>
                        <li class="nav-item">
                            <a href="/admin/settings" class="nav-link <%= active_menu == 'settings' and 'active' or '' %>">
                                <span class="nav-icon">âš™ï¸</span>
                                <span class="nav-text">è¨­å®š</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/" target="_blank" class="nav-link">
                                <span class="nav-icon">ğŸŒ</span>
                                <span class="nav-text">ã‚µã‚¤ãƒˆã‚’è¡¨ç¤º</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
            <main class="admin-main">
                <div class="content-wrapper">
                    <% if page_title then %>
                        <div class="page-header">
                            <h2 class="page-title"><%= page_title %></h2>
                            <% if page_actions then %>
                                <div class="page-actions">
                                    <%- page_actions %>
                                </div>
                            <% end %>
                        </div>
                    <% end %>

                    <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                    <% if success_message then %>
                        <div class="alert alert-success">
                            <span class="alert-icon">âœ“</span>
                            <%= success_message %>
                        </div>
                    <% end %>
                    <% if error_message then %>
                        <div class="alert alert-error">
                            <span class="alert-icon">âš </span>
                            <%= error_message %>
                        </div>
                    <% end %>

                    <!-- å­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å†…å®¹ãŒã“ã“ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ -->
                    <%- content_for_layout %>
                </div>
            </main>
        </div>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <footer class="admin-footer">
            <div class="footer-content">
                <p>&copy; <%= os.date("%Y") %> LuaAIDiary. All rights reserved.</p>
                <p class="footer-links">
                    <a href="https://github.com/yourusername/LuaAIDiary" target="_blank">GitHub</a>
                    <span class="separator">|</span>
                    <a href="/admin/about">About</a>
                    <span class="separator">|</span>
                    <span class="version">Version 1.0.0</span>
                </p>
            </div>
        </footer>
    </div>

    <!-- ç®¡ç†ç”»é¢ç”¨JavaScript -->
    <script>
        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒˆã‚°ãƒ«
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('adminSidebar');
            const wrapper = document.querySelector('.admin-wrapper');

            if (menuToggle && sidebar) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('collapsed');
                    wrapper.classList.toggle('sidebar-collapsed');
                    
                    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«çŠ¶æ…‹ã‚’ä¿å­˜
                    const isCollapsed = sidebar.classList.contains('collapsed');
                    localStorage.setItem('sidebarCollapsed', isCollapsed);
                });

                // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å‰å›ã®çŠ¶æ…‹ã‚’å¾©å…ƒ
                const savedState = localStorage.getItem('sidebarCollapsed');
                if (savedState === 'true') {
                    sidebar.classList.add('collapsed');
                    wrapper.classList.add('sidebar-collapsed');
                }
            }

            // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è‡ªå‹•éè¡¨ç¤º
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                setTimeout(function() {
                    alert.style.opacity = '0';
                    setTimeout(function() {
                        alert.style.display = 'none';
                    }, 300);
                }, 5000);
            });
        });
    </script>
</body>
</html>

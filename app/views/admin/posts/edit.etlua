<div class="page-header">
    <h1><%= is_new and '‚úçÔ∏è Êñ∞Ë¶èÊäïÁ®ø' or '‚úèÔ∏è ÊäïÁ®ø„ÇíÁ∑®ÈõÜ' %></h1>
</div>

<% if error_message then %>
    <div class="alert alert-danger"><%= error_message %></div>
<% end %>

<form method="POST" action="<%= is_new and '/admin/posts' or ('/admin/posts/' .. post.id) %>" class="post-form">
    <input type="hidden" name="_csrf_token" value="<%= csrf_token %>">
    
    <div class="form-row">
        <!-- „É°„Ç§„É≥„Ç®„Éá„Ç£„Çø„Ç®„É™„Ç¢ -->
        <div class="form-main">
            <div class="form-group">
                <label for="title">„Çø„Ç§„Éà„É´</label>
                <input type="text" id="title" name="title" class="form-control form-control-lg" 
                       value="<%= post and post.title or '' %>" required>
            </div>
            
            <div class="form-group">
                <label for="content">Êú¨Êñá</label>
                <div class="editor-preview-container">
                    <div class="editor-pane">
                        <textarea id="content" name="content" class="form-control" rows="20" required><%- post and post.content or '' %></textarea>
                        <small class="form-text">MarkdownË®òÊ≥ï„Åå‰ΩøÁî®„Åß„Åç„Åæ„Åô</small>
                    </div>
                    <div class="preview-pane">
                        <div class="preview-header">üëÅÔ∏è „Éó„É¨„Éì„É•„Éº</div>
                        <div id="preview-area" class="preview-content">
                            <p class="text-muted">Êú¨Êñá„ÇíÂÖ•Âäõ„Åô„Çã„Å®„Éó„É¨„Éì„É•„Éº„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="excerpt">ÊäúÁ≤ã</label>
                <textarea id="excerpt" name="excerpt" class="form-control" rows="3"><%- post and post.excerpt or '' %></textarea>
                <small class="form-text">Ë®ò‰∫ã„ÅÆË¶ÅÁ¥Ñ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÁúÅÁï•ÂèØÔºâ</small>
            </div>
        </div>
        
        <!-- „Çµ„Ç§„Éâ„Éê„Éº -->
        <div class="form-sidebar">
            <!-- ÂÖ¨ÈñãË®≠ÂÆö -->
            <div class="card">
                <div class="card-header">üì§ ÂÖ¨ÈñãË®≠ÂÆö</div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="status">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                        <select id="status" name="status" class="form-control">
                            <option value="draft" <%= (not post or post.status == 'draft') and 'selected' or '' %>>‰∏ãÊõ∏„Åç</option>
                            <option value="published" <%= (post and post.status == 'published') and 'selected' or '' %>>ÂÖ¨Èñã</option>
                            <option value="trash" <%= (post and post.status == 'trash') and 'selected' or '' %>>„Ç¥„ÉüÁÆ±</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-block">
                            <%= is_new and 'ÊäïÁ®ø„Çí‰ΩúÊàê' or 'Êõ¥Êñ∞' %>
                        </button>
                        <a href="/admin/posts" class="btn btn-secondary btn-block">„Ç≠„É£„É≥„Çª„É´</a>
                    </div>
                </div>
            </div>
            
            <!-- „Ç´„ÉÜ„Ç¥„É™„Éº -->
            <div class="card">
                <div class="card-header">üìÅ „Ç´„ÉÜ„Ç¥„É™„Éº</div>
                <div class="card-body">
                    <% if categories and #categories > 0 then %>
                        <% 
                        local selected_cat_ids = {}
                        if post and post.categories then
                            for _, cat in ipairs(post.categories) do
                                selected_cat_ids[cat.id] = true
                            end
                        end
                        %>
                        <% for _, category in ipairs(categories) do %>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input"
                                       id="cat_<%= category.id %>"
                                       name="category_ids[]"
                                       value="<%= category.id %>"
                                       <%= selected_cat_ids[category.id] and 'checked' or '' %>>
                                <label class="form-check-label" for="cat_<%= category.id %>">
                                    <%= category.name %>
                                </label>
                            </div>
                        <% end %>
                    <% else %>
                        <p class="text-muted">„Ç´„ÉÜ„Ç¥„É™„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    <% end %>
                </div>
            </div>
            
            <!-- „Çø„Ç∞ -->
            <div class="card">
                <div class="card-header">üè∑Ô∏è „Çø„Ç∞</div>
                <div class="card-body">
                    <% if tags and #tags > 0 then %>
                        <% 
                        local selected_tag_ids = {}
                        if post and post.tags then
                            for _, tag in ipairs(post.tags) do
                                selected_tag_ids[tag.id] = true
                            end
                        end
                        %>
                        <% for _, tag in ipairs(tags) do %>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input"
                                       id="tag_<%= tag.id %>"
                                       name="tag_ids[]"
                                       value="<%= tag.id %>"
                                       <%= selected_tag_ids[tag.id] and 'checked' or '' %>>
                                <label class="form-check-label" for="tag_<%= tag.id %>">
                                    <%= tag.name %>
                                </label>
                            </div>
                        <% end %>
                    <% else %>
                        <p class="text-muted">„Çø„Ç∞„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                    <% end %>
                </div>
            </div>
        </div>
    </div>
</form>
